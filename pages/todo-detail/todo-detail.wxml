<view class="container">
  <!-- 新增操作栏 -->
  <view class="action-bar" wx:if="{{!isShare}}">
    <image src="/images/edit.png" class="action-icon" bindtap="editTodo" />
    <image src="/images/delete.png" class="action-icon" bindtap="deleteTodo" />
  </view>

  <view class="form-item">
    <!-- 修改标题部分 -->
    <text 
      class="{{isShare ? 'todo-title-share' : 'todo-title'}}" 
      bindlongpress="copyTitle"
    >{{todo.text}}</text>
    
    <!-- 修改日期显示部分 -->
    <view class="date-info">
      <text class="label">时间：</text>
      <text class="value" bindlongpress="copyDate">{{formattedDate}}</text>
    </view>
    
    <!-- 修改备注部分 -->
    <view wx:if="{{todo.remarks}}" class="remarks">
      <text class="label">备注：</text>
      <text class="value" bindlongpress="copyRemarks">{{todo.remarks}}</text>
    </view>
    <view wx:if="{{todo.location}}" class="location-info">
      <text class="label">位置：</text>
      <view class="value" bindlongpress="copyLocation">
        <text class="name">{{todo.location.name}}</text>
        <text class="address">{{todo.location.address}}</text>
        <!-- 新增地图组件 -->
        <view class="map-container">
          <map 
            id="locationMap" 
            longitude="{{todo.location.longitude}}" 
            latitude="{{todo.location.latitude}}" 
            scale="16"
            markers="{{[{id: 0, ...todo.location, iconPath: '/images/marker.png', width: 30, height: 30}]}}"
            style="width: 100%; height: 300rpx"
          ></map>
        </view>
      <button 
        class="nav-btn" 
        bindtap="navigateToLocation" 
        wx:if="{{todo.location}}"
      >导航到这里</button>
      </view>
    </view>
  </view>
</view>
<!-- 底部新增分享提示 -->
<view wx:if="{{isShare}}" class="share-footer">
  <text class="share-tip">正在查看来自于分享的待办</text>
  <button 
    class="add-btn" 
    bindtap="addToMyTodos"
  >添加到我的待办</button>
</view>

<t-fab wx:if="{{!isShare}}" icon="share" button-props="{{shareButton}}" bind:click="onShareAppMessage" text="分享给朋友" />
